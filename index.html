<!DOCTYPE html><html lang="lo">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BN Shop Order System (Firebase)</title>
  <script type="module">
    // Firebase SDK (v9+) แบบ Modular
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, set, update } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";const firebaseConfig = {
  apiKey: "AIzaSyAR4ZN_J3u4nTl2dLpF6eXqE3txaUoYrMY",
  authDomain: "bnchen-93d9d.firebaseapp.com",
  databaseURL: "https://bnchen-93d9d-default-rtdb.firebaseio.com",
  projectId: "bnchen-93d9d",
  storageBucket: "bnchen-93d9d.firebasestorage.app",
  messagingSenderId: "1047651812089",
  appId: "1:1047651812089:web:6f520fa528059cc43e1828",
  measurementId: "G-WK259X0ZQ1"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const customerData = document.getElementById('customerData');
const courierSelect = document.getElementById('courier');
const shopPhoneSelect = document.getElementById('shopPhone');
const ordersContainer = document.getElementById('orders');

courierSelect.addEventListener('change', updatePhoneByCourier);

function updatePhoneByCourier() {
  const courier = courierSelect.value;
  shopPhoneSelect.value = (courier === 'Anousith Express') ? '020 94036226' : '020 98052744';
}

function generateId() {
  return 'BN' + Math.floor(Math.random() * 100000);
}

function addOrder() {
  const customer = customerData.value.trim();
  const courier = courierSelect.value;
  const shopPhone = shopPhoneSelect.value;
  if (!customer) return alert('ກະລຸນາປ້ອນຂໍ້ມູນລູກຄ້າ');

  const id = generateId();
  const date = new Date().toISOString();
  const barcode = Math.floor(100000000000 + Math.random() * 900000000000);

  const order = { id, customer, courier, date, barcode, shopPhone };
  push(ref(db, 'orders'), order);

  customerData.value = '';
}

function renderOrders(data) {
  ordersContainer.innerHTML = '';
  data.forEach(({ key, val }, index) => {
    const order = val;
    const div = document.createElement('div');
    div.className = 'order';
    div.innerHTML = `
      <input type="checkbox" data-key="${key}" checked>
      <strong>Order ID:</strong> ${order.id}<br>
      <strong>ຂົນສົ່ງ:</strong> ${order.courier}<br>
      <strong>ເບີຮ້ານ:</strong> ${order.shopPhone}<br>
      <strong>ລູກຄ້າ:</strong><br> <pre class="customer-pre">${order.customer}</pre>
      <button class="btn btn-danger" onclick="deleteOrder('${key}')">ລຶບ</button>
    `;
    ordersContainer.appendChild(div);
  });
}

window.addOrder = addOrder;
window.deleteOrder = function (key) {
  if (confirm('ລຶບອອເດີນີ້ແທ້ບໍ?')) {
    remove(ref(db, 'orders/' + key));
  }
};

function fetchOrders() {
  const ordersRef = ref(db, 'orders');
  onValue(ordersRef, (snapshot) => {
    const data = snapshot.val();
    const result = [];
    for (const key in data) {
      result.push({ key, val: data[key] });
    }
    renderOrders(result);
  });
}

fetchOrders();

  </script>  <style>
    body { font-family: 'Noto Sans Lao', sans-serif; padding: 20px; }
    h1 { text-align: center; }
    .order-form, .order-list { margin: 20px auto; max-width: 500px; border: 1px solid #ccc; padding: 20px; border-radius: 8px; }
    .form-control { margin-bottom: 10px; }
    .form-control label { display: block; margin-bottom: 5px; }
    .form-control input, .form-control textarea, .form-control select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
    .btn { padding: 10px 20px; border: none; border-radius: 5px; background-color: #007BFF; color: white; cursor: pointer; }
    .btn-danger { background-color: #dc3545; }
    .order { border: 1px dashed #aaa; padding: 10px; margin: 10px 0; position: relative; }
    .order input[type=checkbox] { position: absolute; right: 10px; top: 10px; }
    .customer-pre { white-space: pre-wrap; word-wrap: break-word; font-family: 'Noto Sans Lao', sans-serif; margin: 0; line-height: 1.4; }
  </style></head>
<body>
  <h1>BN Shop Order System (Firebase)</h1>
  <div class="order-form">
    <div class="form-control">
      <label>ຂໍ້ມູນລູກຄ້າ</label>
      <textarea id="customerData" rows="4"></textarea>
    </div>
    <div class="form-control">
      <label>ເລືອກຂົນສົ່ງ</label>
      <select id="courier">
        <option value="HAL LOGISTICS">HAL LOGISTICS</option>
        <option value="Anousith Express">Anousith Express</option>
        <option value="Mixay Express">Mixay Express</option>
      </select>
    </div>
    <div class="form-control">
      <label>ເບີໂທຮ້ານ (ປ່ຽນອັດຕະໂນມັດ)</label>
      <select id="shopPhone" disabled>
        <option value="020 94036226">020 94036226</option>
        <option value="020 98052744">020 98052744</option>
      </select>
    </div>
    <button class="btn" onclick="addOrder()">ຢືນຢັນອອເດີ</button>
  </div>  <div class="order-list">
    <h2>ລາຍການອອເດີທັງໝົດ</h2>
    <div id="orders"></div>
  </div>
</body>
</html>
